---
title: "Analyzing 2022 NFL 4th Down Success by Team"
author: "Jack Miller and Alex Jackson"
output:
  pdf_document: default
  word_document: default
---

```{r}
library(nflfastR)
library(tidyverse)
library(ggrepel)
library(nflplotR)
```

```{r}
stats_2022 <- load_pbp(2022)
team_4th <- stats_2022 %>% 
  filter(down == 4 & (play_type == "run" | play_type == "pass")) %>% 
  filter(wp > 0.02 & wp < 0.98) %>% 
  group_by(posteam) %>% 
  summarise(avg_yds_to_go = mean(ydstogo),
            avg_field_pos = mean(yardline_100),
            count = n(),
            success_rate = sum(fourth_down_converted) / count,
            avg_gained = sum(yards_gained) / count) %>% 
  arrange(desc(success_rate))
team_4th
```

```{r}
ggplot(team_4th, aes(x = success_rate, y = avg_gained)) +
  geom_nfl_logos(aes(team_abbr = posteam), width = team_4th$count / 300, alpha = 0.75) +
  geom_hline(yintercept = mean(team_4th$avg_gained), color = "red", linetype = "dashed", alpha=0.5) +
  geom_vline(xintercept =  mean(team_4th$success_rate), color = "red", linetype = "dashed", alpha=0.5) +
  labs(title = "4th Down Success vs. Average Yards Gained on 4th Down",
       subtitle = "2022 NFL Games, WP between 0.02 and 0.98, Logo Size = # Qualifying Plays",
       y = "Average Yards Gained", x = "4th Down Success Rate", caption = "@nflfastR")
```


